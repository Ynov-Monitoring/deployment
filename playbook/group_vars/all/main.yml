---

############
# MAIN VAR #
############

influxdb_monitoring_db: "monitoring"
influxdb_telegraf_user: "telegraf_probe"
influxdb_telegraf_pass: "very_secret"

############
# TELEGRAF #
############
# doc: https://github.com/manala/ansible-role-telegraf

## INSTALLATION 

telegraf_agent_package_method: repo
telegraf_agent_package_state: latest
telegraf_agent_debug: "false"
telegraf_agent_hostname: "{{ ansible_nodename }}"
telegraf_agent_quiet: "true"
#telegraf_win_install_dir: "C:\Telegraf"
#telegraf_win_logfile: "C:\Telegraf\log"
#telegraf_win_include: "C:\Telegraf\plugins"
telegraf_agent_logfile: /var/log/telegraf/telegraf.log
telegraf_agent_interval: "10"
telegraf_agent_flush_interval: "10"

project_tag: default

telegraf_global_tags:
  - tag_name: Projet
    tag_value: "{{ project_tag }}"

telegraf_agent_output:
  - type: influxdb
    config:
      - urls = ["http://{{ groups['influxdb'] | map('extract', hostvars, ['ansible_ssh_host']) | join(':8086\",\"http://') }}:8086"]
      - database = "{{ influxdb_monitoring_db }}"
      - username = "{{ influxdb_telegraf_user }}"
      - password = "{{ influxdb_telegraf_pass }}"

telegraf_plugins_default:
  - plugin: system
  - plugin: cpu
  - plugin: mem
  - plugin: disk
  - plugin: netstat

############
# InfluxDB #
############
# doc : https://github.com/manala/ansible-role-influxdb
manala_influxdb_databases:
  - database: "{{ influxdb_monitoring_db }}"

manala_influxdb_users:
  - database: "{{ influxdb_monitoring_db }}"
    name: "{{ influxdb_telegraf_user }}"
    password: "{{ influxdb_telegraf_pass }}"

  - database: "{{ influxdb_monitoring_db }}"
    name: grafana
    password: read

manala_influxdb_privileges:
  - database: "{{ influxdb_monitoring_db }}"
    user: "{{ influxdb_telegraf_user }}"
    grant: write

  - database: "{{ influxdb_monitoring_db }}"
    user: grafana
    grant: read

manala_influxdb_dir:
  - /var/lib/influxdb/meta
  - /var/lib/influxdb/data
  - /var/lib/influxdb/wal

manala_influxdb_config:
  - reporting-disabled: true
  - meta:
    - dir: /var/lib/influxdb/meta
  - data:
    - dir: /var/lib/influxdb/data
    - wal-dir: /var/lib/influxdb/wal
  - udp:
    - enabled: false
